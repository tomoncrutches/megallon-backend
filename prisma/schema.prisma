// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id       String @id @default(uuid())
  name     String
  username String @unique
  password String
  Log      Log[]
}

model Product {
  id               String             @id @default(uuid())
  name             String
  stock            Int?
  type             ProductType        @relation(fields: [type_id], references: [id])
  type_id          String // Cambiado a type_id para seguir la convenci√≥n
  image            String
  materialRecipe   MaterialRecipe[]
  ProductionDetail ProductionDetail[]
  SaleDetail       SaleDetail[]
}

model ProductType {
  id      String    @id @default(uuid())
  name    String
  price   Float
  Product Product[]
}

model Client {
  id         String           @id @default(uuid())
  name       String
  email      String
  phone      String
  attention  String?          @default("Sin horarios")
  address    ClientCoordinate @relation(fields: [address_id], references: [id])
  address_id String
  sale       Sale[]
}

model ClientCoordinate {
  id      String   @id @default(uuid())
  lat     String
  lon     String
  address String   @default("-")
  client  Client[]
}

model Material {
  id             String           @id @default(uuid())
  name           String
  stock          Float
  type           String           @default("otros")
  image          String
  actual_price   Float
  materialRecipe MaterialRecipe[]
}

model MaterialRecipe {
  id          String   @id @default(uuid())
  quantity    Float
  material    Material @relation(fields: [material_id], references: [id])
  material_id String
  product     Product  @relation(fields: [product_id], references: [id])
  product_id  String

  @@unique([product_id, material_id])
}

model Sale {
  id         String       @id @default(uuid())
  number     Int          @default(autoincrement())
  date       DateTime
  total      Float
  paid       Boolean      @default(false)
  delivered  Boolean      @default(false)
  client     Client       @relation(fields: [client_id], references: [id])
  client_id  String
  saleDetail SaleDetail[]
}

model SaleDetail {
  id         String  @id @default(uuid())
  quantity   Int
  product    Product @relation(fields: [product_id], references: [id])
  product_id String
  sale       Sale    @relation(fields: [sale_id], references: [id])
  sale_id    String
}

model Production {
  id                String             @id @default(uuid())
  date              DateTime
  hours             Int
  personal_quantity Int
  ProductionDetail  ProductionDetail[]
}

model ProductionDetail {
  id            String     @id @default(uuid())
  production    Production @relation(fields: [production_id], references: [id])
  production_id String
  product       Product    @relation(fields: [product_id], references: [id])
  product_id    String
  quantity      Int
}

model Log {
  id          String   @id @default(uuid())
  date        DateTime @default(now())
  action      String
  description String
  user        User     @relation(fields: [user_id], references: [id])
  user_id     String
}

model Transaction {
  id        String   @id @default(uuid())
  name      String
  value     Float
  type      String
  date      DateTime
  parent_id String? // Esto hace referencia a si
  // la transaccion es generado por una compra (compra de material)
  // o una venta (venta de producto)
}
